# Tasks: Centralized Setup DAG + Product Migration

## 1. Configuration (field_mappings.py)

- [x] 1.1 Add `Product2` mapping to `dags/config/field_mappings.py`
- [x] 1.2 Define Oracle→Salesforce field mappings for Product2
- [x] 1.3 Configure date/decimal transformations

## 2. Setup DAG

- [x] 2.1 Create `dags/setup_salesforce_pipeline.py`
- [x] 2.2 Implement `encrypt_credentials` task
- [x] 2.3 Implement `generate_master_config` task (process-conf.xml)
- [x] 2.4 Implement `verify_configs` task (replaces generate_sdl_mappings - SDL generated by generate_configs.py)

## 3. Execution DAG (Product & Price)

- [x] 3.1 Create `dags/migrate_product_price_dag.py`
- [x] 3.2 Implement `extract_data` task (Oracle multi-table JOIN → CSV)
- [x] 3.3 Implement `run_dataloader` task (Bash)
- [x] 3.4 Implement `audit_results` task

## 4. SDL Mapping File

- [x] 4.1 Create `salesforce/dataloader_conf/mappings/Product2.sdl`

## 5. Data Loader Config

- [x] 5.1 Add `Product2_Process` bean to `salesforce/dataloader_conf/process-conf.xml`

## 6. Verification

- [ ] 6.1 Test Setup DAG generates correct process-conf.xml
- [ ] 6.2 Test Execution DAG extracts data correctly
- [ ] 6.3 Verify parallel execution (no race condition)

## Files Created/Modified

| File | Status | Description |
|------|--------|-------------|
| `dags/config/field_mappings.py` | Modified | Added Product2 mapping |
| `dags/setup_salesforce_pipeline.py` | Created | Setup DAG |
| `dags/migrate_product_price_dag.py` | Created | Execution DAG |
| `salesforce/dataloader_conf/mappings/Product2.sdl` | Created | SDL mapping file |
| `salesforce/dataloader_conf/process-conf.xml` | Modified | Added Product2_Process bean |
